---
import BaseLayout from '@/layouts/Base.astro';
import Banner from '@/components/Banner.vue';
import Footer from '@/components/Footer.vue';
import PostAttr from '@/components/post/PostAttr.vue';
import SidePanel from '@/components/post/SidePanel.vue';
import Outline from '@/components/post/Outline.vue';
import ScrollToTop from '@/components/ScrollToTop.vue';
import ImageViewer from '@/components/overlay/ImageViewer.vue';

import type { MarkdownHeading } from 'astro';
import type { PostFrontmatter } from '@/types/content';

type Props = PostFrontmatter | { headings: MarkdownHeading[] };

const {
  title,
  desc,
  date,
  tags,
  banner_url,
  banner_pos,
  headings,
} = Astro.props;
---

{/*
  Layouts:
    1. <=md
      - main width: 90% (center)
      - side bar: hovering
    2. >=lg
      - main width: 70% (right)
      - side bar: expanded
    3. >=xl
      - main width: 50% (center)
      - side bar: expanded
*/}

<BaseLayout
  title={`${title} | Alan Kuan`}
  {desc}
>
  <main>
    {
      /* Banner */
      banner_url &&
      <Banner
        url={banner_url}
        pos={banner_pos}
        class="w-95% xl:w-300 lg:h-100 mt-4 mx-auto"
        client:idle
      />
    }
    {
      /* set it 0 to make sure it doesn't take space on narrow screens */
      headings.length > 0 &&
      <div class="w-0 md:w-25%">
        <SidePanel {headings} client:load />
      </div>
    }
    <div
      class="
        w-90% md:w-80% xl:w-250
        mx-auto
      "
    >
      {/* Title & Attributes */}
      <div class="my-8">
        <h1 class="text-3xl font-medium">{title}</h1>
        <div class="mt-4">
          <PostAttr {date} {tags} />
        </div>
      </div>
      {/* Content */}
      <div class="md:pa-8 md:text-lg">
        <slot />
      </div>
    </div>
  </main>
  <Footer />

  <ScrollToTop
    class="fixed bottom-3 right-3 md:bottom-8 md:right-4"
    client:idle
  />
  <ImageViewer client:idle />
</BaseLayout>