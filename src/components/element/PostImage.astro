---
import LazyImage from '@/components/LazyImage.vue';

interface Props {
  src: string;
  alt: string;
  title?: string;
}

const { src, alt, title } = Astro.props;
const img_attr = Astro.locals.img_attr_of_src?.[src];
const aspect_ratio = img_attr?.aspect_ratio ?? 1.5;
---

<figure
  class:list={[
    'relative',
    aspect_ratio > 1 ?
      'md:w-90% lg:w-75%' :
      'md:w-75% lg:w-50%',
    'margin-content',
  ]}
>
  {/* Note: post-img is used in post layout */}
  <LazyImage
    {src} {img_attr} {alt} {title}
    class={`
      rounded-md
      transition-all
      has-[img:not(.error)]:cursor-pointer
      has-[img:not(.error)]:hover:shadow-md
      has-[img:not(.error)]:hover:scale-101
      post-img
    `}
    style={{ 'aspect-ratio': aspect_ratio }}
    client:idle
  />
  {
    title &&
    <figcaption class="mt-1 px-4 text-sm italic">
      {title}
    </figcaption>
  }
</figure>

<style scoped>

</style>