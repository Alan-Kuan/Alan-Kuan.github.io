---
import { getCollection, render } from 'astro:content';

import PostLayout from '@/layouts/Post.astro';
import Paragraph from '@/components/element/Paragraph.vue';
import Link from '@/components/element/Link.vue';
import PostImage from '@/components/element/PostImage.astro';
import GitHubCard from '@/components/element/GitHubCard.astro';

import { collections } from '@/content.config.ts';

export async function getStaticPaths() {
  const all_posts = await Promise.all(
    Object.keys(collections).map(async (collection) => {
      const posts = await getCollection(collection);
      return posts ?
        posts.map(post => ({
          params: { collection, slug: post.id },
          props: { post },
        })) : [];
    })
  );

  return all_posts.flat();
}

const { post } = Astro.props;
const { Content, headings, components } = await render(post);
---

<PostLayout {...post.data} {headings}>
  <article class="content">
    <Content
      components={{
        ...components,
        a: Link,
        p: Paragraph,
        img: PostImage,
        GitHubCard,
      }}
    />
  </article>
</PostLayout>