---
import { getCollection } from 'astro:content';

import PostLayout from '@/layouts/Post.astro';
import { post_collection_names } from '@/content/config.ts';

export async function getStaticPaths() {
  const all_posts = await Promise.all(
    post_collection_names.map(async (collection) => {
      const posts = await getCollection(collection);
      return posts ?
        posts.map(post => ({
          params: { collection, slug: post.slug },
          props: { post },
        })) : [];
    })
  );

  return all_posts.flat();
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<PostLayout {...post.data}>
  <article class="content">
    <Content />
  </article>
</PostLayout>