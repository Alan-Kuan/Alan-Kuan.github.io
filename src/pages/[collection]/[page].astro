---
import { getCollection } from 'astro:content';

import ListLayout from '@/layouts/List.astro';
import { collections } from '@/content.config.ts';

export async function getStaticPaths({ paginate }) {
  const all_posts = await Promise.all(
    Object.keys(collections).map(async (collection) => {
      const posts = (await getCollection(collection))
        .sort((a, b) => Date.parse(b.data.date) - Date.parse(a.data.date));
      return posts ? paginate(posts, { pageSize: 8, params: { collection } }) : [];
    })
  );
  return all_posts.flat();
}

const { collection } = Astro.params;
const { page } = Astro.props;

const title = 'Alan Kuan | 官澔恩';
const desc = 'A place telling things about Alan Kuan';
---

<ListLayout
  {title}
  {desc}
  {page}
  prefix={`/${collection}`}
/>