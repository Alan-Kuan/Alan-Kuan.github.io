---
import type { GetStaticPaths, Page } from 'astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry, CollectionKey } from 'astro:content';

import ListLayout from '@/layouts/List.astro';

import { collections } from '@/content.config.ts';
import { byDate } from '@/post_sorting.ts';

interface Props {
  page: Page<CollectionEntry<CollectionKey>>;
}

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const all_posts = await Promise.all(
    Object.keys(collections).map(async (collection) => {
      const posts = (await getCollection(collection as CollectionKey))
        .sort((a, b) => byDate(a, b));
      return posts ? paginate(posts, { pageSize: 8, params: { collection } }) : [];
    })
  );
  return all_posts.flat();
}

const { collection } = Astro.params;
const { page } = Astro.props;

const title = 'Alan Kuan | 官澔恩';
const desc = 'A place telling things about Alan Kuan';
---

<ListLayout
  {title}
  {desc}
  {page}
  prefix={`/${collection}`}
/>