---
import type { GetStaticPaths, Page } from 'astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry, CollectionKey } from 'astro:content';

import ListLayout from '@/layouts/List.astro';

import { byDate } from '@/post_sorting.ts';

interface Props {
  page: Page<CollectionEntry<CollectionKey>>;
}

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const collection_names = ['articles', 'projects'];
  const all_posts = await Promise.all(
    collection_names.map(async (collection) => {
      const posts = (await getCollection(collection as CollectionKey))
        .sort((a, b) => byDate(a, b));
      return posts ? paginate(posts, { pageSize: 8, params: { collection } }) : [];
    })
  );
  return all_posts.flat();
}

function capitalize(str: string) {
  if (!str) return str;
  return str[0].toUpperCase() + str.slice(1);
}

const { collection } = Astro.params;
const { page } = Astro.props;

const title = `${capitalize(collection as string)} (${page.currentPage}/${page.lastPage}) | Alan Kuan`;
const desc = `Alan's ${collection}`;
---

<ListLayout
  {title}
  {desc}
  {page}
  prefix={`/${collection}`}
/>